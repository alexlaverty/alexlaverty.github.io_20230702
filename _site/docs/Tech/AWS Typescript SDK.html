<h1 id="aws-typescript-sdk-examples">AWS TypeScript SDK Examples</h1>

<h2 id="pass-different-values-for-the-instance-type-to-the-script-for-each-environment">Pass different values for the instance type to the script for each environment</h2>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">cdk</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">aws-cdk-lib</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">ec2</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">aws-cdk-lib/aws-ec2</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">rds</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">aws-cdk-lib/aws-rds</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">elbv2</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">aws-cdk-lib/aws-elasticloadbalancingv2</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">MyStack</span> <span class="kd">extends</span> <span class="nx">cdk</span><span class="p">.</span><span class="nx">Stack</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">scope</span><span class="p">:</span> <span class="nx">cdk</span><span class="p">.</span><span class="nx">Construct</span><span class="p">,</span> <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">props</span><span class="p">:</span> <span class="p">{</span> <span class="nl">instanceType</span><span class="p">:</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceType</span> <span class="p">},)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">props</span><span class="p">);</span>

    <span class="c1">// EC2 Instance 1</span>
    <span class="kd">const</span> <span class="nx">instance1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">Instance</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Instance1</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">instanceType</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">instanceType</span><span class="p">,</span>
      <span class="na">machineImage</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">AmazonLinuxImage</span><span class="p">()</span>
    <span class="p">});</span>

    <span class="c1">// EC2 Instance 2</span>
    <span class="kd">const</span> <span class="nx">instance2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">Instance</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Instance2</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">instanceType</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">instanceType</span><span class="p">,</span>
      <span class="na">machineImage</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">AmazonLinuxImage</span><span class="p">()</span>
    <span class="p">});</span>

    <span class="c1">// RDS Database</span>
    <span class="kd">const</span> <span class="nx">database</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">rds</span><span class="p">.</span><span class="nx">DatabaseInstance</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Database</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">engine</span><span class="p">:</span> <span class="nx">rds</span><span class="p">.</span><span class="nx">DatabaseInstanceEngine</span><span class="p">.</span><span class="nx">POSTGRES</span><span class="p">,</span>
      <span class="na">instanceType</span><span class="p">:</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceType</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceClass</span><span class="p">.</span><span class="nx">T2</span><span class="p">,</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceSize</span><span class="p">.</span><span class="nx">MICRO</span><span class="p">)</span>
    <span class="p">});</span>

    <span class="c1">// Load Balancer</span>
    <span class="kd">const</span> <span class="nx">loadBalancer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">elbv2</span><span class="p">.</span><span class="nx">LoadBalancer</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="dl">'</span><span class="s1">LoadBalancer</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">vpc</span><span class="p">:</span> <span class="nx">instance1</span><span class="p">.</span><span class="nx">vpc</span><span class="p">,</span>
      <span class="na">internetFacing</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">});</span>
    <span class="nx">loadBalancer</span><span class="p">.</span><span class="nx">addTarget</span><span class="p">(</span><span class="nx">instance1</span><span class="p">);</span>
    <span class="nx">loadBalancer</span><span class="p">.</span><span class="nx">addTarget</span><span class="p">(</span><span class="nx">instance2</span><span class="p">);</span>

    <span class="c1">// Allow incoming traffic from the EC2 instances to the RDS database</span>
    <span class="nx">instance1</span><span class="p">.</span><span class="nx">connections</span><span class="p">.</span><span class="nx">allowFrom</span><span class="p">(</span><span class="nx">database</span><span class="p">,</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">Port</span><span class="p">.</span><span class="nx">tcp</span><span class="p">(</span><span class="mi">5432</span><span class="p">));</span>
    <span class="nx">instance2</span><span class="p">.</span><span class="nx">connections</span><span class="p">.</span><span class="nx">allowFrom</span><span class="p">(</span><span class="nx">database</span><span class="p">,</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">Port</span><span class="p">.</span><span class="nx">tcp</span><span class="p">(</span><span class="mi">5432</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cdk</span><span class="p">.</span><span class="nx">App</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">devEnv</span> <span class="o">=</span> <span class="p">{</span> <span class="na">account</span><span class="p">:</span> <span class="dl">'</span><span class="s1">123456789101</span><span class="dl">'</span><span class="p">,</span> <span class="na">region</span><span class="p">:</span> <span class="dl">'</span><span class="s1">us-west-2</span><span class="dl">'</span> <span class="p">};</span>
<span class="k">new</span> <span class="nx">MyStack</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="dl">'</span><span class="s1">MyStackDev</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">env</span><span class="p">:</span> <span class="nx">devEnv</span><span class="p">,</span>
  <span class="na">instanceType</span><span class="p">:</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceType</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceClass</span><span class="p">.</span><span class="nx">T2</span><span class="p">,</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceSize</span><span class="p">.</span><span class="nx">MICRO</span><span class="p">),</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">testEnv</span> <span class="o">=</span> <span class="p">{</span> <span class="na">account</span><span class="p">:</span> <span class="dl">'</span><span class="s1">123456789102</span><span class="dl">'</span><span class="p">,</span> <span class="na">region</span><span class="p">:</span> <span class="dl">'</span><span class="s1">us-west-2</span><span class="dl">'</span> <span class="p">};</span>
<span class="k">new</span> <span class="nx">MyStack</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="dl">'</span><span class="s1">MyStackTest</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">env</span><span class="p">:</span> <span class="nx">testEnv</span><span class="p">,</span>
  <span class="na">instanceType</span><span class="p">:</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceType</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceClass</span><span class="p">.</span><span class="nx">T2</span><span class="p">,</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceSize</span><span class="p">.</span><span class="nx">SMALL</span><span class="p">),</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">prodEnv</span> <span class="o">=</span> <span class="p">{</span> <span class="na">account</span><span class="p">:</span> <span class="dl">'</span><span class="s1">123456789103</span><span class="dl">'</span><span class="p">,</span> <span class="na">region</span><span class="p">:</span> <span class="dl">'</span><span class="s1">us-west-2</span><span class="dl">'</span> <span class="p">};</span>
<span class="k">new</span> <span class="nx">MyStack</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="dl">'</span><span class="s1">MyStackProd</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">env</span><span class="p">:</span> <span class="nx">prodEnv</span><span class="p">,</span>
  <span class="na">instanceType</span><span class="p">:</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceType</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceClass</span><span class="p">.</span><span class="nx">T2</span><span class="p">,</span> <span class="nx">ec2</span><span class="p">.</span><span class="nx">InstanceSize</span><span class="p">.</span><span class="nx">MEDIUM</span><span class="p">),</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">synth</span><span class="p">();</span>
</code></pre></div></div>
